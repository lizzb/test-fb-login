<!DOCTYPE html>
<html>
<head>
<title>Facebook Login JavaScript Example</title>
<meta charset="UTF-8">
</head>
<body>


<script>

/*
Steps for Using Facebook Login With the JavaScript SDK

High-level steps to integrate Facebook Login into a web application:

1. _Checking the login status_ to see if someone's already logged into your app. During this step, you also should check to see if someone has previously logged into your app, but is not currently logged in.
2. If they are not logged in, _invoke the login dialog_ and ask for a set of data permissions.
3. Verify their identity.
4. Store the resulting access token.
5. Make API calls.
6. Log out.
*/

  // This is called with the results from from FB.getLoginStatus().
  function statusChangeCallback(response) {
    console.log('statusChangeCallback');
    console.log(response);
    // The response object is returned with a status field that
    // lets the app know the current login status of the person.
    // Full docs on the response object can be found
    // in the documentation for FB.getLoginStatus().
    if (response.status === 'connected') {
      // Logged into your app and Facebook.
      testAPI();
    } else if (response.status === 'not_authorized') {
      // The person is logged into Facebook, but not your app.
      document.getElementById('status').innerHTML = 'Please log ' +
        'into this app.';
    } else {
      // The person is not logged into Facebook,
      // so we're not sure if they are logged into this app or not.
      document.getElementById('status').innerHTML = 'Please log ' +
        'into Facebook.';
    }
  }

  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.
  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }

  window.fbAsyncInit = function() {
  FB.init({
    appId      : '742522205838021',
    cookie     : true,  // enable cookies to allow the server to access 
                        // the session
    xfbml      : true,  // parse social plugins on this page
    version    : 'v2.1' // use version 2.1
  });

  // Now that we've initialized the JavaScript SDK,
  // we call FB.getLoginStatus(). 
  // This function gets the state of the person visiting this page
  // and can return one of 3 states to the callback you provide.
  // They can be:
  //
  // 1. Logged into your app ('connected')
  // 2. Logged into Facebook, but not your app ('not_authorized')
  // 3. Not logged into Facebook and can't tell if they are logged into
  //    your app or not.
  //
  // These three cases are handled in the callback function.

  FB.getLoginStatus(function(response) {
    statusChangeCallback(response);
  });

  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));




  // Here we run a very simple test of the Graph API after login is
  // successful.  See statusChangeCallback() for when this call is made.
  function testAPI() {
    //console.log('Welcome!  Fetching your information.... ');
    FB.api('/me', function(response) {
      console.log('Successful login for: ' + response.name);
      //document.getElementById('status').innerHTML =
      //  'Thanks for logging in, ' + response.name + '!';
      document.getElementById('status').innerHTML = 'Logged in as: ' + response.name;
    });
  }


function getPhotos() {
  FB.getLoginStatus(function(response) {
    if (response.status === 'connected') {
      getFBPhotos(document.getElementById('numPhotos').value);
    } 
    else if (response.status === 'not_authorized') {
      // The person is logged into Facebook, but not your app.
      document.getElementById('photos').innerHTML = 'Please authorize ' +
        'this app using the Facebook login button to pull recent photos.';
    } else {
      document.getElementById('photos').innerHTML = 'Please log ' +
        'into Facebook to pull recent photos.';
    }
  });
  
}


function getFBPhotos(N) {

  var i = 0;
  var list = document.getElementById('photos');
  list.innerHTML = ""; // clear the div in case it had photos in it already


  /* make the API call */
  //var allPhotos = FB.api(
    FB.api(
    // this requires permission of user_photos
    //which fb seems to be picky about
    // like big red ugly flag like i'll do something illegal
    //"/me/photos", // /uploaded
    "/me/photos?limit="+N,
    //"/me/photos/uploaded",
    function (allPhotos) { //function (response) {
      //console.log(response);
      if (allPhotos && !allPhotos.error) { //if (response && !response.error) 
        /* handle the result */
        //console.log(response);
        //allPhotos = response;
        //console.log('allPhotos shoudl exist now maybe');
        //console.log('allPhotos.data', allPhotos.data);
        //console.log('allPhotos["data"]', allPhotos["data"]);

        // if (allPhotos)
        // if its not equal to null and has a size
// shoudl be array of photos 

      if( (allPhotos.data.length == 0) || (allPhotos.data.length < N) ) {
        if(allPhotos.data.length == 0) 
          list.innerHTML = "You aren't tagged in any photos!";
        else
          list.innerHTML = "You don't have " + N + " photos tagged of you... Posting all existing photos."
      }

      else {



  //if(allPhotos.data.length;)

// https://developers.facebook.com/docs/graph-api/reference/v2.2/photo
// backdated_time is when it was taken
// but it doesnt always exist!! 
  // sort descending by "created_time"
  // which is when they were published
  // in order to find most recent
  allPhotos["data"].sort(
    function(a, b) { 
      //console.log("a.created_time.getTime()", a.created_time.getTime(), " b.created_time.getTime()", b.created_time.getTime());
      return new Date(b.created_time).getTime() - new Date(a.created_time).getTime(); 
    });

  // counter for adding visual interest by alternating masonry
  // of the images based on orientation/layout/dimensions
    var portraitCount = 0;
    var landscapeCount = 0;


        for(i = 0; i<allPhotos.data.length; i++) {

          var photo = allPhotos.data[i]; //pic

          var imgDiv = document.createElement('div');
          imgDiv.className="item";
          var imgDate = new Date(photo.created_time); 
          //(photo.back....
          //var content = document.createTextNode(imgDate.toDateString());

          // jankyyy
          imgDiv.innerHTML = "<small>"+imgDate.toDateString() + "</small><br>";
           //imgDiv.style.backgroundImage = photo.source;
          
//imgDiv.width = photo.width / 4;

          var pic = document.createElement('img');
          
          
          pic.src = photo.source;
         
          // Determine picture dimensions for visual interest

          // Portrait/vertical orientation picture
          if(pic.height > pic.width) {
            //pic.height = photo.height / 2.5; // 4
            if (portraitCount % 2) pic.height = 200;
            else pic.height = 400;
            portraitCount++;
          }
          // Horizontal/Landscape orientation picture (or square)
          else {
            if (landscapeCount % 2 && (!portraitCount % 2)) pic.height = 100;
            else pic.height = 200;
            landscapeCount++;
          }
          
          //ticker++;

          //imgDiv.appendChild(content);
          imgDiv.appendChild(pic);
          //imgDiv.maxWidth =
          
          list.appendChild(imgDiv);

          /*var item = allPhotos.data[i];
          var o = document.createElement('img');
          o.className="item";
          //o.className='picture';
          //o.src = item.thumbnail;
          //o.src = item.icon; // icon = the photo fb icon
          o.src = item.source;
          o.height = item.height / 4;
          //o.title = item.name;

          // Append to the list
          list.appendChild(o);
          var p = document.createElement('div');
          var imgdate = new Date(item.created_time);
          var content = document.createTextNode(""+imgdate.toDateString());
          //var content = document.createTextNode("date<br>"+item.created_time + "<br>alt<br>" + item.created_time);
          p.appendChild(content);
          p.className = "item";
          list.appendChild(p);

          /*var m = document.createElement('div');
          m.className="item";
          m.appendChild(content);
          p.appendChild(o);
          list.appendChild(m);*/
        }
      }
    }
}
);

// allPhotos doesnt exist out heuhh
//console.log('allPhotos.data', allPhotos.data);
//console.log('allPhotos["data"]', allPhotos["data"]);

//console.log(allPhotos);
//console.log(allPhotos['data']); // instead of .data

//} end if allPhotos braces
//console.log("all photos at end", allPhotos);


}

</script>

<!--
  Below we include the Login Button social plugin.
  This button uses the JavaScript SDK to present
  a graphical Login button that triggers
  the FB.login() function when clicked.
-->
<fb:login-button scope="public_profile,user_photos" onlogin="checkLoginState();">
</fb:login-button>

<div id="status"></div>

Number of most recent photos to pull from Facebook: 
<input type="number" id="numPhotos" min="1" max="25" value="6">
<br><br>

<!-- should only show this button if already logged in -->
<button id="photobtn" onclick="getPhotos()">Get Photos!</button>


<div id="photos" class="masonry js-masonry"></div>




<script src="http://masonry.desandro.com/masonry.pkgd.js"></script>
<script>
//<div id="photos" class="masonry js-masonry"  data-masonry-options='{ "columnWidth": 60 }'></div>
var container = document.querySelector('#photos');
var msnry = new Masonry( container, {
  columnWidth: 200,
  itemSelector: '.item'
});

</script>

<style>

.masonry {
  background: #EEE;
  /*max-width: 640px;*/ }

.masonry .item {
  /*height: 40%;
  width:  60px;
  height: 60px;*/
  float: left;
  background: lightblue; /*#D26;*/
  border: 2px solid #333;
  border-color: hsla(0, 0%, 0%, 0.5);
  /*border-radius: 5px;*/
}
</style>


</body>
</html>



